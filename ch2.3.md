## R 的資料結構

在試算表(LibreOffice scalc 或 Excel)中，
輸入的資料並不需要考慮其[資料結構(data structure)](https://en.wikipedia.org/wiki/Data_structure)，
什麼是「資料結構」呢？簡單來說就是電腦儲存資料並有效率使用資料的方式，
但 R 裡頭考量到資料處理的特性，有向量(vector)、資料框架(Data Frame)、矩陣(matrix)等不同的資料結構，
本節將介紹這幾類不同的資料結構以及如何使用。

### 向量(Vector)

假設有一些資料的數值，我們想把它們聚合(concatenate)在一起，R 可以使用 ```c()```
來把資料聚合成「向量(vector)」的形式，例如:

```R
> x <- c(1,3,5,7,9)
> x
[1] 1 3 5 7 9
# 此時可以使用 length() 來計算此 x 向量的長度
> length(x)
[1] 5
```
### 類別(factor)

類別(factor)是把向量處理成具有不同等級的因子，例如在植群生態調查資料中，
Braun-Blanquet 法把不同覆蓋度的估值轉換成 +, r, 1, 2, ... 等不同等級，
雖然有些類別是整數，在統計分析的時候整數和類別計算出來的結果不相同。
而 R 裡頭的類別是使用 ```factor()``` 來建立，例如：

```R
> factor(c(1,2,3,4,3,2,1))
[1] 1 2 3 4 3 2 1
Levels: 1 2 3 4
```

你也可以使用文字來建立類別，例如：

```R
> factor(c('a', 'b', 'c', 'e', 'a'))
[1] a b c e a
Levels: a b c e
```

### 資料框架(Data Frame)

R 裡頭預設而且最常使用的資料結構是「資料框架」，你可以使用 ```data.frame()```
建立一個資料框架，例如：

```R
> x <- c(1,3,5,7,9)
> x.df <- data.frame(x)
x.df
  x
1 1
2 3
3 5
4 7
5 9
```

在顯示資料框架時，每直行(欄; column)最上方會有欄位名稱，
而橫列則預設會有數字序列(1, 2, 3, ... , n)代表列的索引。

### 矩陣

和資料框架很類似，假設我們有 9 個數字，要設定資料結構為 3x3 的矩陣，
可以使用 ```matrix()```：

```R
> x <- c(1,3,5,7,9,11,13,15,17)
> matrix(x, nrow = 3, ncol = 3, byrow = TRUE)
      [,1] [,2] [,3]
[1,]    1    3    5
[2,]    7    9   11
[3,]   13   15   17
```

需要注意的是，如果你希望這九個數字的順序分別是依照列(row)來排列的話，
請記得參數要加上 ```byrow = TRUE```，反之依照欄(column)排列的話，
則使用 ```byrow = FALSE``` (預設是 by column)。

```R
> matrix(x, nrow = 3, ncol = 3, byrow = FALSE)
      [,1] [,2] [,3]
[1,]    1    7   13
[2,]    3    9   15
[3,]    5   11   17
```

### 列表(list)

前述的向量是一維的資料，而矩陣和資料框架則是二維的資料，而列表則可以是三維的資料。
建立一個列表可使用 ```list()```，在下面的例子中，我們使用 ```sample()``` 
隨機建立兩個 3x3 的矩陣，分別指定為 x 及 y，並把他們用 ```list()``` 合併起來：

```R
# 使用 sample() 建立隨機的正整數
> x <- matrix(sample(9), nrow=3)
> y <- matrix(sample(9), nrow=3)
> list_xy <- list(x, y)
> list_xy
[[1]]
     [,1] [,2] [,3]
[1,]    4    7    6
[2,]    9    3    5
[3,]    2    8    1

[[2]]
     [,1] [,2] [,3]
[1,]    8    2    7
[2,]    3    1    6
[3,]    4    9    5

```

當看 list_xy 這個列表時，原本的 x 上方有 ```[[1]]]```，
y 上方則有 ```[[2]]]``` 來註記，這個是列表的編號。
因此你可以使用 ```list_xy[[1]]``` 來取得編號 1 的矩陣資料。

### 判斷及轉換不同的資料結構

判斷資料結構時，只要把資料結構的名稱前加上 ```is.``` 即可，例如：

```R
> is.vector(x)
[1] TRUE
> is.data.frame(x)
[1] FALSE
```

轉換資料結構也只需使用 ```as.資料結構名稱```，例如：

```R
> x <- c(1,3,5,7,9)
> as.data.frame(x)
  x
  1 1
  2 3
  3 5
  4 7
  5 9
```

### 資料結構的索引

設定成資料框架或矩陣的好處就是你可以用 subscript 的方式來列出資料，
在 R 裡頭通常使用中括號(```[列數, 行數]```)來表示，例如列出第三行第五列

```R
# 隨機產生 50 個整數，使用 sample() 函式
> x <- sample(50)
> x.m <- matrix(x, nrow = 10)
> x.df <- data.frame(x.m)
> x.m
      [,1] [,2] [,3] [,4] [,5]
 [1,]   19    7   31   32   25
 [2,]   33   14   13   46   40
 [3,]   16   12   35    8   29
 [4,]   27    3   36   48   20
 [5,]   10   18    4   11   49
 [6,]   43   22   50    9    2
 [7,]   30    1   41   47   15
 [8,]   21    6   38   44   34
 [9,]    5   42   45   26   17
[10,]   37   28   39   23   24
> x.m[3,5]
[1] 29
```

如果僅要列出某特定「列」或特定「行」，可以使用:

```R
# 列出第三列
> x.m[3,]
[1] 16 12 35  8 29
# 列出第三行
> x.m[,3]
[1] 31 13 35 36  4 50 41 38 45 39
```

另一個 R 強大的功能就是你可以指定特定列數、行數外，
還可以做邏輯判斷和數學運算，例如我們把第三列取 log 值：

```R
> log10(x.m[3,])
[1] 1.204120 1.079181 1.544068 0.903090 1.462398
```

或是條件篩選，把第三列中大於 30 的數字選出來

```R
> x.m[3,] > 30
[1] FALSE FALSE  TRUE FALSE FALSE
```

你會發現它只會顯示邏輯判斷，即 True 或 False，若要顯示大於 30 的數字呢？

```R
> x.m[3, x.m[3,]>30]
[1] 35
```
